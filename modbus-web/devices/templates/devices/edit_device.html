<!DOCTYPE html>
<html>
<head>
    <title>Edit Device</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { max-width: 500px; }
        label { display: block; margin: 10px 0 5px; }
        input { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { padding: 10px 20px; margin: 10px 5px 10px 0; }
        .back-link { display: block; margin-top: 20px; }
        .btn-delete { background: #dc3545; color: white; border: none; }
    </style>
</head>
<body>
    <h1>Edit Modbus Device</h1>
    <form method="post">
        {% csrf_token %}
        <div>
            <label>Device Name:</label>
            <input type="text" name="name" value="{{ device.name }}" required>
        </div>
        <div>
            <label>IP Address:</label>
            <input type="text" name="ip" value="{{ device.ip }}" required>
        </div>
        <div>
            <label>Port:</label>
            <input type="number" name="port" value="{{ device.port }}" required>
        </div>
        <div>
            <label>Slave ID:</label>
            <input type="number" name="slave_id" value="{{ device.slave_id }}" required>
        </div>
        <div>
            <label>Write Register:</label>
            <input type="number" name="write_register" value="{{ device.write_register }}" required>
        </div>
        <div>
            <label>Write Mask:</label>
            <input type="number" name="write_mask" value="{{ device.write_mask }}" required>
        </div>
        <div>
            <label>Read Register:</label>
            <input type="number" name="read_register" value="{{ device.read_register }}" required>
        </div>
        <div>
            <label>Read Mask:</label>
            <input type="number" name="read_mask" value="{{ device.read_mask }}" required>
        </div>
        <button type="submit">Save Changes</button>
        <button type="button" class="btn-delete" onclick="deleteDevice()">Delete Device</button>
    </form>
    <a href="{% url 'device_list' %}" class="back-link">‚Üê Back to devices list</a>

    <script>
        function deleteDevice() {
            if (confirm('Are you sure you want to delete this device?')) {
                fetch(`/delete/{{ device.name }}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = '/';
                    } else {
                        alert('Error deleting device: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error deleting device:', error);
                    alert('Error deleting device');
                });
            }
        }
    </script>
</body>
</html>